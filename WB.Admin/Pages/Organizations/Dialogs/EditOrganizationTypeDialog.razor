@using WB.Shared.Dtos.Organization.RequestDtos;
@using WB.Shared.Dtos.Organization.ResponseDtos

<div class="container-fluid">
    <RadzenTemplateForm Data="OrganizationTypeDetail" TItem="UpdateOrganizationTypeRequestDto" Submit="@OnSubmitUpdateOrganization">
        <div class="row mb-3">
            <div class="col-xl-6">
                <label class="form-label d-block">Created Date</label>
                <span class="fs-12 text-muted">@OrganizationTypeDetail.CreatedDate</span>
            </div>
            <div class="col-xl-6">
                <label class="form-label d-block">Status</label>
                <span class="fs-12 text-muted">@(OrganizationTypeDetail.IsActive ? "Active" : "In Active")</span>
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-xl-6">
                <label class="form-label d-block">Name (English)</label>
                <RadzenTextBox Name="OrganizationTypeNameEn" @bind-Value="OrganizationTypeDetail.NameEn" Placeholder="Organization Type Name (En)" />
                <RadzenRequiredValidator Component="OrganizationTypeNameEn" Text="Required Field" />
            </div>
            <div class="col-xl-6">
                <label class="form-label d-block">Name (Arabic)</label>
                <RadzenTextBox Name="OrganizationTypeNameAr" @bind-Value="OrganizationTypeDetail.NameAr" Placeholder="Organization Type Name (Ar)" />
                <RadzenRequiredValidator Component="OrganizationTypeNameAr" Text="Required Field" />
            </div>
        </div>
        <div class="d-flex justify-content-end mt-3 gap-3 pb-2">
            <RadzenButton ButtonStyle="ButtonStyle.Primary" Text="Submit" ButtonType="ButtonType.Submit" />
            <RadzenButton ButtonStyle="ButtonStyle.Light" Text="Cancel" Click="@(() => dialogService.Close())" />
        </div>
    </RadzenTemplateForm>
</div>

@code 
{
    #region Parameters
    [Parameter]
    public int OrganizationTypeId { get; set; }
    #endregion

    #region Variables Declaration
    private UpdateOrganizationTypeRequestDto OrganizationTypeDetail { get; set; } = new();
    #endregion

    #region On Component Load
    protected override async Task OnInitializedAsync()
    {
        await GetOrganizationTypeDetail();
    }
    #endregion

    #region Populate Organization Type Detail
    private async Task GetOrganizationTypeDetail()
    {
        try
        {
            var response = await apiHelper.SendGetAsync<OrganizationTypeDetailResponseDto>($"Organizations/GetOrganizationTypeDetail?typeId={OrganizationTypeId}");
            if (response.IsSuccessStatusCode)
            {
                OrganizationTypeDetail = mapper.Map<UpdateOrganizationTypeRequestDto>(response.ResultData);
                await InvokeAsync(StateHasChanged);
            }
            else
            {
                await invalidRequestHandler.ReturnBadRequestNotification(response);
            }
        }
        catch (Exception)
        {
            notificationService.Notify(new NotificationMessage()
            {
                Severity = NotificationSeverity.Error,
                Detail = "Something_went_wrong_Please_try_again",
            });
        }
    }
    #endregion

    #region Button Events
    private async Task OnSubmitUpdateOrganization()
    {
        try
        {
            bool? dialogResponse = await dialogService.Confirm(
            translationState.Translate("Sure_Submit"),
            translationState.Translate("Confirm"),
            new ConfirmOptions()
            {
                CancelButtonText = translationState.Translate("Cancel"),
                OkButtonText = translationState.Translate("OK")
            });
            if (dialogResponse == true)
            {
                OrganizationTypeDetail.TypeId = OrganizationTypeId;
                var response = await apiHelper.SendAsync<UpdateOrganizationTypeRequestDto, object>(HttpMethod.Post, "Organizations/UpdateOrganizationType", OrganizationTypeDetail, hasReturnData: false);
                if (response.IsSuccessStatusCode)
                {
                    notificationService.Notify(new NotificationMessage()
                    {
                        Severity = NotificationSeverity.Success,
                        Detail = "Organization Type Updated Successfully",
                    });
                    dialogService.Close(1);
                }
                else
                {
                    await invalidRequestHandler.ReturnBadRequestNotification(response);
                }
            }
        }
        catch (Exception)
        {
            notificationService.Notify(new NotificationMessage()
            {
                Severity = NotificationSeverity.Error,
                Detail = translationState.Translate("Something_went_wrong_Please_try_again"),
            });
        }
    }
    #endregion
}